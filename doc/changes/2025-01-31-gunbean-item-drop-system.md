# æªè±†äººé“å…·æ‰è½ç³»ç»Ÿ

## æ—¥æœŸ
2025-01-31

## ä¿®æ”¹å†…å®¹
å®ç°æ€ªç‰©æ­»äº¡åéšæœºæ‰è½é“å…·ç³»ç»Ÿã€‚

## ä¿®æ”¹æ–‡ä»¶
- `shared/Events.js` - æ·»åŠ é“å…·ç›¸å…³äº‹ä»¶
- `server/games/gunbean/GunBeanHandler.js` - é“å…·æ‰è½å’Œæ‹¾å–é€»è¾‘
- `client/games/gunbean/GunBeanScene.js` - é“å…·æ¸²æŸ“
- `client/games/gunbean/GunBeanGame.js` - é“å…·æ‹¾å–å¤„ç†

## é“å…·é…ç½®

| é“å…·ç±»å‹ | æ‰è½æ¦‚ç‡ | æ•ˆæœ | å›¾æ ‡ |
|----------|----------|------|------|
| å›è¡€é“å…· | 20% | +2 HP | â¤ï¸ |
| å…¨å±ç£é“ | 5% | ç«‹å³å¸å–å…¨å±ç»éªŒå€¼ | ğŸ§² |

## å®ç°è¯¦æƒ…

### 1. äº‹ä»¶å®šä¹‰ (shared/Events.js)
```javascript
// é“å…·ç³»ç»Ÿäº‹ä»¶
ITEM_SPAWNED: 'gunbean:itemSpawned',           // é“å…·ç”Ÿæˆ
ITEM_COLLECTED: 'gunbean:itemCollected',       // é“å…·è¢«æ”¶é›†
MAGNET_PULSE: 'gunbean:magnetPulse'            // å…¨å±ç£é“è„‰å†²æ•ˆæœ
```

### 2. æœåŠ¡ç«¯å®ç°

#### æ¸¸æˆçŠ¶æ€æ·»åŠ é“å…·Map
```javascript
items: new Map(),        // é“å…·ï¼ˆå›è¡€ã€ç£é“ç­‰ï¼‰
itemIdCounter: 0,        // é“å…·IDè®¡æ•°å™¨
```

#### killEnemy ä¸­æ·»åŠ æ‰è½é€»è¾‘
```javascript
// å›è¡€é“å…· 20%ï¼Œå…¨å±ç£é“ 5%
const roll = Math.random() * 100;
if (roll < 20) {
    this.spawnItem(game, enemy.x, enemy.y, 'health');
} else if (roll >= 20 && roll < 25) {
    this.spawnItem(game, enemy.x, enemy.y, 'magnet');
}
```

#### æ–°å¢å‡½æ•°
- `spawnItem(game, x, y, type)` - ç”Ÿæˆé“å…·
- `collectItem(game, boat, item)` - å¤„ç†é“å…·æ‹¾å–
  - å›è¡€ï¼šboat.hp + 2
  - ç£é“ï¼šç«‹å³å¸å–æ‰€æœ‰ç»éªŒçƒ

#### ç‰©ç†æ›´æ–°æ·»åŠ é“å…·ç¢°æ’æ£€æµ‹
- é“å…·å­˜æ´»æ—¶é—´ï¼š60ç§’
- æ‹¾å–èŒƒå›´ï¼šèˆ¹åªåŠå¾„ + 20åƒç´ 
- **è¾¹ç•Œé™åˆ¶**ï¼šé“å…·åŠå¾„20ï¼Œé™åˆ¶åœ¨åœºåœ°å†…

#### ç”Ÿæˆæ—¶è¾¹ç•Œæ£€æµ‹
- spawnItem å‡½æ•°ä¸­æ·»åŠ è¾¹ç•Œæ£€æµ‹
- ç¡®ä¿é“å…·ç”Ÿæˆæ—¶å°±åœ¨åœºåœ°è¾¹ç•Œå†…

### 3. å®¢æˆ·ç«¯å®ç°

#### GunBeanScene.js
- æ·»åŠ  `items: new Map()`
- æ–°å¢å‡½æ•°ï¼š
  - `createItem(itemData)` - åˆ›å»ºé“å…·
  - `removeItem(itemId)` - ç§»é™¤é“å…·
  - `drawItem(ctx, item)` - ç»˜åˆ¶é“å…·
  - `createMagnetPulse(x, y)` - åˆ›å»ºç£é“è„‰å†²
  - `drawMagnetPulses(ctx)` - ç»˜åˆ¶ç£é“è„‰å†²

#### GunBeanGame.js
- äº‹ä»¶ç›‘å¬ï¼š
  - `ITEM_SPAWNED` - é“å…·ç”Ÿæˆ
  - `ITEM_COLLECTED` - é“å…·è¢«æ”¶é›†
  - `MAGNET_PULSE` - ç£é“è„‰å†²
- äº‹ä»¶å¤„ç†å‡½æ•°ï¼š
  - `handleItemSpawned(data)`
  - `handleItemCollected(data)`
  - `handleMagnetPulse(data)`

## è§†è§‰æ•ˆæœ

### é“å…·å¤–è§‚
- å›è¡€é“å…·ï¼šçº¢è‰²å¿ƒå½¢â¤ï¸ï¼Œçº¢è‰²å‘å…‰
- ç£é“ï¼šè“è‰²ç£é“å›¾æ ‡ğŸ§²ï¼Œè“è‰²å‘å…‰
- è„‰å†²å‘¼å¸æ•ˆæœ

### æ‹¾å–æ•ˆæœ
- 8ä¸ªç²’å­å‘å››å‘¨æ‰©æ•£
- å›è¡€ï¼šçº¢è‰²ç²’å­ + æµ®åŠ¨æ–‡å­— "+2 â¤ï¸"
- ç£é“ï¼šè“è‰²ç²’å­ + æµ®åŠ¨æ–‡å­— "å…¨å±ç£é“!"

### ç£é“è„‰å†²
- è“è‰²åœ†ç¯ä»ä¸­å¿ƒå‘å¤–æ‰©æ•£
- æŒç»­æ—¶é—´0.5ç§’
- èŒƒå›´è¦†ç›–å…¨å±ï¼ˆ800åƒç´ åŠå¾„ï¼‰

## é“å…·è¡Œä¸º

| ç‰¹æ€§ | æè¿° |
|------|------|
| ç”Ÿæˆä½ç½® | æ•Œäººæ­»äº¡ä½ç½® |
| å­˜æ´»æ—¶é—´ | 60ç§’åè‡ªåŠ¨æ¶ˆå¤± |
| æ‹¾å–æ–¹å¼ | èˆ¹åªç¢°æ’ |
| æ‹¾å–èŒƒå›´ | èˆ¹åªåŠå¾„ + 20åƒç´  |
| å›è¡€ä¸Šé™ | ä¸è¶…è¿‡æœ€å¤§HP |
| ç£é“æ•ˆæœ | ç«‹å³å¸å–åœºä¸Šæ‰€æœ‰ç»éªŒçƒ |
