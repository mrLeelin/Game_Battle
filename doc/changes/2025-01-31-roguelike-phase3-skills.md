# æžªè±†äºº Roguelike ç¬¬ä¸‰é˜¶æ®µæŠ€èƒ½å®žçŽ°

## æ—¥æœŸ
2025-01-31

## æ¦‚è¿°
å®žçŽ° Roguelike æŠ€èƒ½ç³»ç»Ÿç¬¬ä¸‰é˜¶æ®µçš„4ä¸ªè¾ƒé«˜éš¾åº¦æŠ€èƒ½ï¼šåˆ†è£‚å¼¹ã€å›žæ—‹é•–ã€å¼¹å¹•ã€ç”µç£è„‰å†²ã€‚

## ä¿®æ”¹æ–‡ä»¶

### 1. server/games/gunbean/GunBeanSkillData.js

**æ–°å¢žæŠ€èƒ½é…ç½®**ï¼ˆ4ä¸ªï¼‰ï¼š

| ID | åç§° | å›¾æ ‡ | ç¨€æœ‰åº¦ | æè¿° | æ¯çº§æ•ˆæžœ | æœ€å¤§ç­‰çº§ |
|----|------|------|--------|------|----------|----------|
| splitBullet | åˆ†è£‚å¼¹ | ðŸ’  | Rare | å­å¼¹å‘½ä¸­åŽåˆ†è£‚æˆå°å­å¼¹ | +2é¢—åˆ†è£‚å¼¹ | 3 |
| boomerang | å›žæ—‹é•– | ðŸªƒ | Rare | å­å¼¹é£žå‡ºåŽè¿”å›ž | +1æ¬¡è¿”å›ž | 2 |
| orbitalBullet | å¼¹å¹• | ðŸŒ€ | Rare | å°„å‡»æ—¶é¢å¤–å‘å°„çŽ¯ç»•å­å¼¹ | +1é¢—çŽ¯ç»•å¼¹ | 3 |
| empPulse | ç”µç£è„‰å†² | ðŸ“¡ | Epic | å®šæœŸé‡Šæ”¾è„‰å†²çœ©æ™•å‘¨å›´æ•Œäºº | +0.5ç§’çœ©æ™• | 3 |

### 2. server/games/gunbean/GunBeanHandler.js

**ä¿®æ”¹å†…å®¹**ï¼š

#### 2.1 æ¸¸æˆçŠ¶æ€æ–°å¢žå­—æ®µ
- `lastEmpTime`: ä¸Šæ¬¡ç”µç£è„‰å†²æ—¶é—´

#### 2.2 å­å¼¹å¯¹è±¡æ–°å¢žå±žæ€§
- `split`: åˆ†è£‚å¼¹ç­‰çº§
- `boomerang`: å›žæ—‹é•–ç­‰çº§
- `boomerangReturns`: å‰©ä½™è¿”å›žæ¬¡æ•°
- `startX`, `startY`: èµ·å§‹ä½ç½®ï¼ˆç”¨äºŽå›žæ—‹é•–è·ç¦»è®¡ç®—ï¼‰
- `maxDistance`: æœ€å¤§é£žè¡Œè·ç¦»
- `returning`: æ˜¯å¦æ­£åœ¨è¿”å›ž
- `isSplitBullet`: æ˜¯å¦ä¸ºåˆ†è£‚å¼¹ï¼ˆé˜²æ­¢æ— é™åˆ†è£‚ï¼‰
- `isOrbital`: æ˜¯å¦ä¸ºçŽ¯ç»•å¼¹

#### 2.3 handleShoot æ–¹æ³•
- æ–°å¢ž `splitLevel`, `boomerangLevel`, `orbitalLevel` å˜é‡
- å­å¼¹å¯¹è±¡æ·»åŠ å›žæ—‹é•–ç›¸å…³å±žæ€§
- æ–°å¢žå¼¹å¹•ï¼ˆçŽ¯ç»•å­å¼¹ï¼‰ç”Ÿæˆé€»è¾‘

#### 2.4 hitEnemy æ–¹æ³•
- æ–°å¢žåˆ†è£‚å¼¹æ•ˆæžœï¼šå‘½ä¸­æ•Œäººæ—¶ç”Ÿæˆå¤šé¢—å°å­å¼¹å‘å››å‘¨æ•£å°„

#### 2.5 updatePhysics æ–¹æ³•
- æ–°å¢žå›žæ—‹é•–æ•ˆæžœï¼šå­å¼¹é£žè¡Œä¸€å®šè·ç¦»åŽåè½¬æ–¹å‘
- æ–°å¢žç”µç£è„‰å†²æ•ˆæžœï¼šæ¯8ç§’é‡Šæ”¾ä¸€æ¬¡èŒƒå›´çœ©æ™•
- æ–°å¢žæ•Œäººçœ©æ™•çŠ¶æ€å¤„ç†ï¼šçœ©æ™•æ—¶æ•Œäººä¸ç§»åŠ¨

### 3. shared/Events.js

**æ–°å¢žäº‹ä»¶**ï¼š
- `EMP_PULSE`: ç”µç£è„‰å†²æ•ˆæžœäº‹ä»¶

## ä»£ç  Diff

### GunBeanSkillData.js
```diff
+    // ==================== ç¬¬ä¸‰é˜¶æ®µæŠ€èƒ½ ====================
+    {
+        id: 'splitBullet',
+        name: 'åˆ†è£‚å¼¹',
+        icon: 'ðŸ’ ',
+        rarity: 'rare',
+        description: 'å­å¼¹å‘½ä¸­åŽåˆ†è£‚æˆå°å­å¼¹',
+        effectPerLevel: '+2é¢—åˆ†è£‚å¼¹',
+        maxLevel: 3
+    },
+    {
+        id: 'boomerang',
+        name: 'å›žæ—‹é•–',
+        icon: 'ðŸªƒ',
+        rarity: 'rare',
+        description: 'å­å¼¹é£žå‡ºåŽè¿”å›ž',
+        effectPerLevel: '+1æ¬¡è¿”å›ž',
+        maxLevel: 2
+    },
+    {
+        id: 'orbitalBullet',
+        name: 'å¼¹å¹•',
+        icon: 'ðŸŒ€',
+        rarity: 'rare',
+        description: 'å°„å‡»æ—¶é¢å¤–å‘å°„çŽ¯ç»•å­å¼¹',
+        effectPerLevel: '+1é¢—çŽ¯ç»•å¼¹',
+        maxLevel: 3
+    },
+    {
+        id: 'empPulse',
+        name: 'ç”µç£è„‰å†²',
+        icon: 'ðŸ“¡',
+        rarity: 'epic',
+        description: 'å®šæœŸé‡Šæ”¾è„‰å†²çœ©æ™•å‘¨å›´æ•Œäºº',
+        effectPerLevel: '+0.5ç§’çœ©æ™•',
+        maxLevel: 3
+    }
```

### GunBeanHandler.js
```diff
 // æ¸¸æˆçŠ¶æ€æ–°å¢žå­—æ®µ
+            lastEmpTime: 0,          // ä¸Šæ¬¡ç”µç£è„‰å†²æ—¶é—´

 // handleShoot æ–¹æ³• - æ–°å¢žæŠ€èƒ½å˜é‡
+        const splitLevel = gamePlayer.skills['splitBullet'] || 0;
+        const boomerangLevel = gamePlayer.skills['boomerang'] || 0;
+        const orbitalLevel = gamePlayer.skills['orbitalBullet'] || 0;

 // å­å¼¹å¯¹è±¡æ–°å¢žå±žæ€§
+                    split: splitLevel,
+                    boomerang: boomerangLevel,
+                    boomerangReturns: boomerangLevel,
+                    startX: bulletStartX,
+                    startY: bulletStartY,
+                    maxDistance: 300,
+                    returning: false,

 // hitEnemy æ–¹æ³• - åˆ†è£‚å¼¹æ•ˆæžœ
+        if (bullet.split > 0 && !bullet.isSplitBullet) {
+            const splitCount = bullet.split * 2;
+            for (let i = 0; i < splitCount; i++) {
+                // ç”Ÿæˆåˆ†è£‚å­å¼¹...
+            }
+        }

 // updatePhysics æ–¹æ³• - å›žæ—‹é•–æ•ˆæžœ
+            if (bullet.boomerang > 0 && bullet.boomerangReturns > 0 && !bullet.returning) {
+                const distance = Math.sqrt(dx * dx + dy * dy);
+                if (distance >= bullet.maxDistance) {
+                    bullet.vx = -bullet.vx;
+                    bullet.vy = -bullet.vy;
+                    bullet.returning = true;
+                    bullet.boomerangReturns--;
+                }
+            }

 // updatePhysics æ–¹æ³• - æ•Œäººçœ©æ™•çŠ¶æ€
+            if (enemy.stunned) {
+                if (now > enemy.stunnedUntil) {
+                    enemy.stunned = false;
+                } else {
+                    return; // çœ©æ™•æ—¶ä¸ç§»åŠ¨
+                }
+            }

 // updatePhysics æ–¹æ³• - ç”µç£è„‰å†²æ•ˆæžœ
+        if (now - game.lastEmpTime >= 8000) {
+            game.lastEmpTime = now;
+            // å¯¹èŒƒå›´å†…æ•Œäººæ–½åŠ çœ©æ™•...
+        }

 // handleShoot æ–¹æ³• - å¼¹å¹•æ•ˆæžœ
+        if (orbitalLevel > 0) {
+            const orbitalCount = orbitalLevel;
+            for (let i = 0; i < orbitalCount; i++) {
+                // ç”ŸæˆçŽ¯ç»•å­å¼¹...
+            }
+        }
```

### Events.js
```diff
+    // ç‰¹æ®ŠæŠ€èƒ½äº‹ä»¶
+    EMP_PULSE: 'gunbean:empPulse'
```

## åŠŸèƒ½å¯¹æ¯”

| åŠŸèƒ½ | ä¿®æ”¹å‰ | ä¿®æ”¹åŽ |
|------|--------|--------|
| æŠ€èƒ½æ€»æ•° | 29ä¸ª | 33ä¸ª |
| å­å¼¹ç±»åž‹ | æ™®é€šå­å¼¹ | æ™®é€š + åˆ†è£‚ + çŽ¯ç»• |
| å­å¼¹è¡Œä¸º | ç›´çº¿é£žè¡Œ | ç›´çº¿ + å›žæ—‹é•–è¿”å›ž |
| æŽ§åˆ¶æ•ˆæžœ | å†°å†»ã€æ—¶é—´å‡ç¼“ | å†°å†»ã€æ—¶é—´å‡ç¼“ã€çœ©æ™• |

## æŠ€èƒ½æœºåˆ¶è¯´æ˜Ž

### åˆ†è£‚å¼¹ ðŸ’ 
- å­å¼¹å‘½ä¸­æ•ŒäººåŽåˆ†è£‚æˆå¤šé¢—å°å­å¼¹
- åˆ†è£‚æ•°é‡ = æŠ€èƒ½ç­‰çº§ Ã— 2
- åˆ†è£‚å¼¹ä¼¤å®³ä¸ºåŽŸå­å¼¹çš„50%
- åˆ†è£‚å¼¹ä¸ä¼šå†æ¬¡åˆ†è£‚ï¼ˆé˜²æ­¢æ— é™åˆ†è£‚ï¼‰
- åˆ†è£‚å¼¹ç»§æ‰¿å†°å†»ã€æ¯’ç´ ã€ç«ç„°æ•ˆæžœ

### å›žæ—‹é•– ðŸªƒ
- å­å¼¹é£žè¡Œ300åƒç´ åŽåè½¬æ–¹å‘è¿”å›ž
- è¿”å›žæ¬¡æ•° = æŠ€èƒ½ç­‰çº§
- 2çº§æ—¶å­å¼¹å¯ä»¥æ¥å›žé£žè¡Œ2æ¬¡
- è¿”å›žæ—¶å¯ä»¥å†æ¬¡å‘½ä¸­æ•Œäºº

### å¼¹å¹• ðŸŒ€
- å°„å‡»æ—¶é¢å¤–å‘å°„çŽ¯ç»•å­å¼¹
- çŽ¯ç»•å¼¹æ•°é‡ = æŠ€èƒ½ç­‰çº§
- çŽ¯ç»•å¼¹å‡åŒ€åˆ†å¸ƒåœ¨åœ†å‘¨ä¸Š
- çŽ¯ç»•å¼¹ä¼¤å®³ç•¥ä½Žï¼Œå­˜æ´»æ—¶é—´è¾ƒçŸ­
- çŽ¯ç»•å¼¹ç»§æ‰¿å†°å†»ã€æ¯’ç´ ã€ç«ç„°æ•ˆæžœ

### ç”µç£è„‰å†² ðŸ“¡
- æ¯8ç§’è‡ªåŠ¨é‡Šæ”¾ä¸€æ¬¡è„‰å†²
- è„‰å†²èŒƒå›´200åƒç´ 
- çœ©æ™•æ—¶é—´ = æŠ€èƒ½ç­‰çº§ Ã— 0.5ç§’
- çœ©æ™•æœŸé—´æ•Œäººå®Œå…¨åœæ­¢ç§»åŠ¨
- ä¸Žå†°å†»ã€æ—¶é—´å‡ç¼“æ•ˆæžœå¯å åŠ 

## å›žé€€æ–¹æ¡ˆ

å¦‚éœ€å›žé€€ï¼Œæ¢å¤ä»¥ä¸‹æ–‡ä»¶åˆ°ä¿®æ”¹å‰çŠ¶æ€ï¼š
1. `server/games/gunbean/GunBeanSkillData.js` - åˆ é™¤4ä¸ªæ–°å¢žæŠ€èƒ½é…ç½®
2. `server/games/gunbean/GunBeanHandler.js` - æ¢å¤åŽŸæœ‰é€»è¾‘
3. `shared/Events.js` - åˆ é™¤ EMP_PULSE äº‹ä»¶

## æµ‹è¯•å»ºè®®

1. å¯åŠ¨æ¸¸æˆï¼Œå‡çº§æ—¶æ£€æŸ¥æ˜¯å¦èƒ½çœ‹åˆ°4ä¸ªæ–°æŠ€èƒ½
2. é€‰æ‹©åˆ†è£‚å¼¹æŠ€èƒ½ï¼ŒéªŒè¯å­å¼¹å‘½ä¸­æ•ŒäººåŽæ˜¯å¦åˆ†è£‚
3. é€‰æ‹©å›žæ—‹é•–æŠ€èƒ½ï¼ŒéªŒè¯å­å¼¹æ˜¯å¦åœ¨é£žè¡Œä¸€å®šè·ç¦»åŽè¿”å›ž
4. é€‰æ‹©å¼¹å¹•æŠ€èƒ½ï¼ŒéªŒè¯å°„å‡»æ—¶æ˜¯å¦é¢å¤–å‘å°„çŽ¯ç»•å­å¼¹
5. é€‰æ‹©ç”µç£è„‰å†²æŠ€èƒ½ï¼Œç­‰å¾…8ç§’éªŒè¯å‘¨å›´æ•Œäººæ˜¯å¦è¢«çœ©æ™•
