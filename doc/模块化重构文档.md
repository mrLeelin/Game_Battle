# æ¨¡å—åŒ–é‡æ„æ–‡æ¡£

**é‡æ„æ—¥æœŸ**: 2025-01-29
**ç‰ˆæœ¬**: v2.0.0
**é‡æ„ç›®æ ‡**: å°†å•ä½“æ¶æ„é‡æ„ä¸ºæ¨¡å—åŒ–æ¶æ„ï¼Œå®ç°å¤§å…ä¸æ¸¸æˆè§£è€¦ï¼Œæ”¯æŒå¤šæ¸¸æˆç±»å‹æ‰©å±•

---

## ä¸€ã€é‡æ„èƒŒæ™¯

### 1.1 åŸæ¶æ„é—®é¢˜

åŸé¡¹ç›®é‡‡ç”¨å•ä½“æ¶æ„ï¼Œå­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š

| é—®é¢˜ | æè¿° |
|------|------|
| **é«˜åº¦è€¦åˆ** | UIã€ç½‘ç»œã€æ¸²æŸ“ã€æ¸¸æˆé€»è¾‘å…¨éƒ¨æ··åœ¨ `game.js` (843è¡Œ) |
| **ä¸å¯æ‰©å±•** | æ— æ³•æ”¯æŒå¤šç§æ¸¸æˆç±»å‹ |
| **éš¾ä»¥ç»´æŠ¤** | å•æ–‡ä»¶è¿‡å¤§ï¼ŒèŒè´£ä¸æ¸…æ™° |
| **ç¼ºå°‘çŠ¶æ€ç®¡ç†** | æˆ¿é—´çŠ¶æ€ã€ç©å®¶é™åˆ¶ç­‰åˆ†æ•£åœ¨ä»£ç ä¸­ |

### 1.2 åŸæ–‡ä»¶ç»“æ„

```
Battle/
â”œâ”€â”€ client/
â”‚   â”œâ”€â”€ game.js       # 843è¡Œï¼Œæ‰€æœ‰å®¢æˆ·ç«¯é€»è¾‘
â”‚   â”œâ”€â”€ index.html
â”‚   â””â”€â”€ style.css
â”œâ”€â”€ server/
â”‚   â””â”€â”€ server.js     # 289è¡Œï¼Œæ‰€æœ‰æœåŠ¡ç«¯é€»è¾‘
â”œâ”€â”€ GEMINI.md
â”œâ”€â”€ vite.config.js
â””â”€â”€ å¼€å§‹æ¸¸æˆ.bat
```

---

## äºŒã€æ–°æ¶æ„è®¾è®¡

### 2.1 è®¾è®¡åŸåˆ™

1. **å¤§å…ä¸æ¸¸æˆè§£è€¦** - å¤§å…æ¨¡å—åªå¤„ç†æˆ¿é—´ç®¡ç†ï¼Œä¸å…³å¿ƒå…·ä½“æ¸¸æˆç±»å‹
2. **æ¸¸æˆæ¨¡å—å¯æ’æ‹”** - æ–°å¢æ¸¸æˆåªéœ€æ³¨å†Œå’Œåˆ›å»ºå¯¹åº”æ¨¡å—
3. **å…±äº«å¸¸é‡å’Œäº‹ä»¶** - å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å…±ç”¨å¸¸é‡å®šä¹‰ï¼Œé¿å…ä¸ä¸€è‡´
4. **å•ä¸€èŒè´£** - æ¯ä¸ªæ¨¡å—åªè´Ÿè´£ä¸€ä¸ªåŠŸèƒ½é¢†åŸŸ

### 2.2 æ–°æ–‡ä»¶ç»“æ„

```
Battle/
â”œâ”€â”€ shared/                        # å®¢æˆ·ç«¯/æœåŠ¡ç«¯å…±äº«ä»£ç 
â”‚   â”œâ”€â”€ Constants.js               # å…¨å±€å¸¸é‡ï¼ˆæˆ¿é—´é…ç½®ã€ç½‘ç»œé…ç½®ï¼‰
â”‚   â”œâ”€â”€ Events.js                  # Socket äº‹ä»¶åå®šä¹‰
â”‚   â””â”€â”€ GameTypes.js               # æ¸¸æˆç±»å‹æ³¨å†Œè¡¨
â”‚
â”œâ”€â”€ client/                        # å®¢æˆ·ç«¯ä»£ç 
â”‚   â”œâ”€â”€ main.js                    # åº”ç”¨å…¥å£ï¼ŒçŠ¶æ€ç®¡ç†
â”‚   â”‚
â”‚   â”œâ”€â”€ core/                      # æ ¸å¿ƒæ¨¡å—ï¼ˆä¸æ¸¸æˆç±»å‹æ— å…³ï¼‰
â”‚   â”‚   â”œâ”€â”€ EventBus.js            # äº‹ä»¶æ€»çº¿ï¼Œæ¨¡å—é—´é€šä¿¡
â”‚   â”‚   â”œâ”€â”€ Network.js             # Socket.io å®¢æˆ·ç«¯å°è£…
â”‚   â”‚   â””â”€â”€ SceneManager.js        # Three.js åœºæ™¯ç®¡ç†
â”‚   â”‚
â”‚   â”œâ”€â”€ lobby/                     # å¤§å…æ¨¡å—ï¼ˆä¸æ¸¸æˆè§£è€¦ï¼‰
â”‚   â”‚   â”œâ”€â”€ LobbyManager.js        # å¤§å…ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ LobbyUI.js             # ç™»å½•/å¤§å…ç•Œé¢
â”‚   â”‚   â””â”€â”€ RoomUI.js              # æˆ¿é—´ç•Œé¢
â”‚   â”‚
â”‚   â”œâ”€â”€ games/                     # æ¸¸æˆæ¨¡å—ï¼ˆå¯æ‰©å±•ï¼‰
â”‚   â”‚   â”œâ”€â”€ GameBase.js            # æ¸¸æˆæŠ½è±¡åŸºç±»
â”‚   â”‚   â””â”€â”€ fps/                   # FPS æ¸¸æˆ
â”‚   â”‚       â”œâ”€â”€ FPSGame.js         # FPS ä¸»é€»è¾‘
â”‚   â”‚       â”œâ”€â”€ FPSPlayer.js       # å…¶ä»–ç©å®¶å¯è§†åŒ–
â”‚   â”‚       â”œâ”€â”€ FPSWeapon.js       # æ­¦å™¨ç³»ç»Ÿ
â”‚   â”‚       â”œâ”€â”€ FPSWorld.js        # åœºæ™¯æ„å»º
â”‚   â”‚       â””â”€â”€ FPSHUD.js          # æ¸¸æˆå†… HUD
â”‚   â”‚
â”‚   â”œâ”€â”€ ui/                        # é€šç”¨ UI ç»„ä»¶ï¼ˆé¢„ç•™ï¼‰
â”‚   â”œâ”€â”€ index.html
â”‚   â””â”€â”€ style.css
â”‚
â”œâ”€â”€ server/                        # æœåŠ¡ç«¯ä»£ç 
â”‚   â”œâ”€â”€ index.js                   # æœåŠ¡ç«¯å…¥å£
â”‚   â”‚
â”‚   â”œâ”€â”€ core/                      # æ ¸å¿ƒæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ SocketManager.js       # Socket è¿æ¥ç®¡ç†
â”‚   â”‚   â””â”€â”€ PlayerManager.js       # ç©å®¶æ•°æ®ç®¡ç†
â”‚   â”‚
â”‚   â”œâ”€â”€ lobby/                     # å¤§å…æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ LobbyHandler.js        # å¤§å…äº‹ä»¶å¤„ç†
â”‚   â”‚   â””â”€â”€ RoomManager.js         # æˆ¿é—´ç®¡ç†
â”‚   â”‚
â”‚   â””â”€â”€ games/                     # æ¸¸æˆæ¨¡å—
â”‚       â”œâ”€â”€ GameRouter.js          # æ¸¸æˆäº‹ä»¶è·¯ç”±
â”‚       â””â”€â”€ fps/
â”‚           â””â”€â”€ FPSGameHandler.js  # FPS æœåŠ¡ç«¯é€»è¾‘
â”‚
â”œâ”€â”€ doc/                           # æ–‡æ¡£ç›®å½•
â”œâ”€â”€ CLAUDE.md                      # Claude Code æŒ‡å¯¼æ–‡ä»¶
â”œâ”€â”€ package.json
â”œâ”€â”€ vite.config.js
â””â”€â”€ å¼€å§‹æ¸¸æˆ.bat
```

---

## ä¸‰ã€æ¨¡å—è¯¦è§£

### 3.1 å…±äº«æ¨¡å— (shared/)

#### Constants.js
å®šä¹‰å…¨å±€å¸¸é‡ï¼Œç¡®ä¿å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¸€è‡´ï¼š

```javascript
export const ROOM = {
    MAX_PLAYERS: 8,      // æˆ¿é—´æœ€å¤§äººæ•°
    MIN_PLAYERS: 2,      // å¼€å§‹æ¸¸æˆæœ€å°äººæ•°
    STATUS: {
        WAITING: 'waiting',   // åŒ¹é…ä¸­ï¼ˆå¯åŠ å…¥ï¼‰
        RUNNING: 'running'    // æ¸¸æˆä¸­ï¼ˆä¸å¯åŠ å…¥ï¼‰
    }
};
```

#### Events.js
ç»Ÿä¸€ç®¡ç† Socket äº‹ä»¶åï¼Œåˆ†ç±»æ¸…æ™°ï¼š

| åˆ†ç±» | å‰ç¼€ | ç”¨é€” |
|------|------|------|
| å¤§å…äº‹ä»¶ | `lobby:` | ç™»å½•ã€æˆ¿é—´åˆ—è¡¨ã€åŠ å…¥æˆ¿é—´ |
| æˆ¿é—´äº‹ä»¶ | `room:` | å‡†å¤‡ã€æ¸¸æˆç±»å‹ã€å¼€å§‹æ¸¸æˆ |
| æ¸¸æˆé€šç”¨äº‹ä»¶ | `game:` | ç©å®¶ç§»åŠ¨ã€åŠ¨ä½œã€çŠ¶æ€åŒæ­¥ |
| FPSä¸“ç”¨äº‹ä»¶ | `fps:` | å°„å‡»ã€å‘½ä¸­ã€æ­»äº¡ã€é‡ç”Ÿ |

#### GameTypes.js
æ¸¸æˆç±»å‹æ³¨å†Œè¡¨ï¼Œæ·»åŠ æ–°æ¸¸æˆåªéœ€åœ¨æ­¤æ³¨å†Œï¼š

```javascript
export const GAME_TYPES = {
    FPS: {
        id: 'fps',
        name: 'FPS å°„å‡»',
        icon: 'ğŸ”«',
        minPlayers: 2,
        maxPlayers: 8,
        clientModule: './games/fps/FPSGame.js',
        serverHandler: './games/fps/FPSGameHandler.js'
    },
    // æ·»åŠ æ–°æ¸¸æˆ...
};
```

---

### 3.2 å®¢æˆ·ç«¯æ ¸å¿ƒæ¨¡å— (client/core/)

#### EventBus.js
äº‹ä»¶æ€»çº¿ï¼Œç”¨äºæ¨¡å—é—´è§£è€¦é€šä¿¡ï¼š

```javascript
// è®¢é˜…äº‹ä»¶
eventBus.on('room:stateUpdated', (state) => { ... });

// å‘å¸ƒäº‹ä»¶
eventBus.emit('game:start', { gameType: 'fps' });
```

#### Network.js
Socket.io å®¢æˆ·ç«¯å°è£…ï¼š

- è¿æ¥ç®¡ç†
- äº‹ä»¶å‘é€/ç›‘å¬
- æ–­çº¿é‡è¿å¤„ç†

#### SceneManager.js
Three.js åœºæ™¯ç®¡ç†ï¼š

- æ¸²æŸ“å™¨åˆå§‹åŒ–
- åå¤„ç†æ•ˆæœ
- åœºæ™¯å¯¹è±¡ç®¡ç†
- çª—å£å¤§å°é€‚é…

---

### 3.3 å¤§å…æ¨¡å— (client/lobby/)

**å…³é”®ç‰¹æ€§**: ä¸æ¸¸æˆç±»å‹å®Œå…¨è§£è€¦

#### LobbyManager.js
å¤§å…ä¸šåŠ¡é€»è¾‘ï¼š

- ç”¨æˆ·åè®¾ç½®
- æˆ¿é—´åˆ—è¡¨è·å–
- åˆ›å»º/åŠ å…¥/ç¦»å¼€æˆ¿é—´
- å‡†å¤‡çŠ¶æ€åˆ‡æ¢
- æ¸¸æˆç±»å‹è®¾ç½®ï¼ˆæˆ¿ä¸»ï¼‰
- å¼€å§‹æ¸¸æˆï¼ˆæˆ¿ä¸»ï¼‰

#### LobbyUI.js / RoomUI.js
ç•Œé¢æ¸²æŸ“ï¼š

- ç™»å½•ç•Œé¢
- æˆ¿é—´åˆ—è¡¨ï¼ˆæ˜¾ç¤ºçŠ¶æ€ï¼šç­‰å¾…ä¸­/æ¸¸æˆä¸­ï¼‰
- æˆ¿é—´å†…ç©å®¶åˆ—è¡¨ï¼ˆæ˜¾ç¤ºå‡†å¤‡çŠ¶æ€ï¼‰
- æ¸¸æˆç±»å‹é€‰æ‹©ä¸‹æ‹‰æ¡†

---

### 3.4 æ¸¸æˆæ¨¡å— (client/games/)

#### GameBase.js
æ¸¸æˆæŠ½è±¡åŸºç±»ï¼Œå®šä¹‰æ¸¸æˆç”Ÿå‘½å‘¨æœŸï¼š

```javascript
class GameBase {
    // å¿…é¡»å®ç°çš„æŠ½è±¡æ–¹æ³•
    async init() { }      // åˆå§‹åŒ–
    update(delta) { }     // æ¸¸æˆå¾ªç¯
    destroy() { }         // é”€æ¯

    // é€šç”¨æ–¹æ³•
    start() { }           // å¯åŠ¨æ¸¸æˆå¾ªç¯
    stop() { }            // åœæ­¢æ¸¸æˆå¾ªç¯
    pause() / resume() { }

    // ç½‘ç»œäº‹ä»¶å¤„ç†ï¼ˆå¯é‡å†™ï¼‰
    onPlayerMove(data) { }
    onPlayerAction(data) { }
    onPlayerDisconnected(data) { }
    onGameEnd(data) { }
}
```

#### FPS æ¸¸æˆæ¨¡å—

| æ–‡ä»¶ | èŒè´£ |
|------|------|
| `FPSGame.js` | ç»§æ‰¿ GameBaseï¼Œå®ç° FPS ä¸»é€»è¾‘ |
| `FPSWorld.js` | åœºæ™¯æ„å»ºï¼ˆåœ°æ¿ã€å»ºç­‘ã€å¤©ç©ºã€å…‰ç…§ï¼‰ |
| `FPSPlayer.js` | å…¶ä»–ç©å®¶çš„ 3D æ¨¡å‹å’Œä½ç½®æ›´æ–° |
| `FPSWeapon.js` | æ­¦å™¨ç³»ç»Ÿï¼ˆå°„å‡»ã€æ¢å¼¹ã€åååŠ›ï¼‰ |
| `FPSHUD.js` | æ¸¸æˆå†… HUDï¼ˆè¡€é‡ã€å¼¹è¯ã€å‘½ä¸­æŒ‡ç¤ºï¼‰ |

---

### 3.5 æœåŠ¡ç«¯æ¨¡å— (server/)

#### PlayerManager.js
ç©å®¶æ•°æ®ç®¡ç†ï¼š

```javascript
// ç©å®¶æ•°æ®ç»“æ„
{
    id: socketId,
    name: 'ç©å®¶å',
    roomId: null,
    ready: false,
    x: 0, y: 0, z: 0,
    rotation: 0, pitch: 0,
    health: 100
}
```

#### RoomManager.js
æˆ¿é—´ç®¡ç†ï¼Œæ ¸å¿ƒåŠŸèƒ½ï¼š

- åˆ›å»ºæˆ¿é—´ï¼ˆè®¾ç½®æˆ¿ä¸»ï¼‰
- åŠ å…¥æˆ¿é—´ï¼ˆæ£€æŸ¥çŠ¶æ€å’Œäººæ•°ï¼‰
- ç¦»å¼€æˆ¿é—´ï¼ˆæˆ¿ä¸»è½¬ç§»ï¼‰
- è®¾ç½®æ¸¸æˆç±»å‹ï¼ˆä»…æˆ¿ä¸»ï¼‰
- å¼€å§‹æ¸¸æˆï¼ˆæ£€æŸ¥å‡†å¤‡çŠ¶æ€ï¼‰

#### GameRouter.js
æ ¹æ®æˆ¿é—´çš„æ¸¸æˆç±»å‹ï¼Œè·¯ç”±äº‹ä»¶åˆ°å¯¹åº”çš„å¤„ç†å™¨ï¼š

```javascript
this.handlers = {
    fps: new FPSGameHandler(io, playerManager, roomManager),
    racing: new RacingGameHandler(...),  // æœªæ¥æ‰©å±•
};
```

---

## å››ã€æ¸¸æˆæµç¨‹

### 4.1 çŠ¶æ€æµè½¬å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   LOGIN     â”‚ â”€â”€â”€ è¾“å…¥ç”¨æˆ·å
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   LOBBY     â”‚ â”€â”€â”€ æŸ¥çœ‹æˆ¿é—´åˆ—è¡¨
â”‚             â”‚ â”€â”€â”€ åˆ›å»º/åŠ å…¥æˆ¿é—´
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    ROOM     â”‚ â”€â”€â”€ æˆ¿ä¸»é€‰æ‹©æ¸¸æˆç±»å‹
â”‚             â”‚ â”€â”€â”€ ç©å®¶ç‚¹å‡»å‡†å¤‡
â”‚             â”‚ â”€â”€â”€ æˆ¿ä¸»å¼€å§‹æ¸¸æˆ
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    GAME     â”‚ â”€â”€â”€ åŠ¨æ€åŠ è½½å¯¹åº”æ¸¸æˆæ¨¡å—
â”‚             â”‚ â”€â”€â”€ æ¸¸æˆè¿›è¡Œä¸­
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   RESULT    â”‚ â”€â”€â”€ æ¸¸æˆç»“ç®—ï¼ˆé¢„ç•™ï¼‰
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
    è¿”å› ROOM
```

### 4.2 å…³é”®äº‹ä»¶åºåˆ—

#### åŠ å…¥æˆ¿é—´
```
Client                          Server
  â”‚                               â”‚
  â”‚â”€â”€â”€â”€ lobby:joinRoom â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
  â”‚                               â”‚â”€â”€ æ£€æŸ¥æˆ¿é—´çŠ¶æ€/äººæ•°
  â”‚â—€â”€â”€â”€ lobby:joinSuccess â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚â—€â”€â”€â”€ room:stateUpdate â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚                               â”‚
```

#### å¼€å§‹æ¸¸æˆ
```
Host Client                     Server                    Other Clients
  â”‚                               â”‚                           â”‚
  â”‚â”€â”€â”€â”€ room:startGame â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                           â”‚
  â”‚                               â”‚â”€â”€ æ£€æŸ¥æ‰€æœ‰äººå‡†å¤‡çŠ¶æ€      â”‚
  â”‚                               â”‚â”€â”€ è®¾ç½®æˆ¿é—´çŠ¶æ€ä¸º running  â”‚
  â”‚â—€â”€â”€â”€ room:gameStarting â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€ room:gameStarting â”€â”€â”€â–¶â”‚
  â”‚                               â”‚                           â”‚
  â”‚â”€â”€ åŠ è½½æ¸¸æˆæ¨¡å—                â”‚                           â”‚â”€â”€ åŠ è½½æ¸¸æˆæ¨¡å—
  â”‚                               â”‚                           â”‚
```

---

## äº”ã€å¦‚ä½•æ·»åŠ æ–°æ¸¸æˆ

### 5.1 æ³¨å†Œæ¸¸æˆç±»å‹

åœ¨ `shared/GameTypes.js` ä¸­æ·»åŠ ï¼š

```javascript
export const GAME_TYPES = {
    // ...ç°æœ‰æ¸¸æˆ
    RACING: {
        id: 'racing',
        name: 'ç«é€Ÿèµ›è½¦',
        description: 'å¤šäººç«é€Ÿæ¯”èµ›',
        icon: 'ğŸï¸',
        minPlayers: 2,
        maxPlayers: 8,
        clientModule: './games/racing/RacingGame.js',
        serverHandler: './games/racing/RacingGameHandler.js'
    }
};
```

### 5.2 åˆ›å»ºå®¢æˆ·ç«¯æ¸¸æˆæ¨¡å—

```
client/games/racing/
â”œâ”€â”€ RacingGame.js      # ç»§æ‰¿ GameBase
â”œâ”€â”€ RacingCar.js       # èµ›è½¦æ¨¡å‹
â”œâ”€â”€ RacingTrack.js     # èµ›é“
â””â”€â”€ RacingHUD.js       # ç«é€Ÿ HUD
```

`RacingGame.js` ç¤ºä¾‹ï¼š

```javascript
import { GameBase } from '../GameBase.js';

export class RacingGame extends GameBase {
    async init() {
        // åˆå§‹åŒ–èµ›é“ã€èµ›è½¦ç­‰
    }

    update(delta) {
        // æ›´æ–°ç‰©ç†ã€ä½ç½®åŒæ­¥
    }

    destroy() {
        // æ¸…ç†èµ„æº
    }
}
```

### 5.3 åˆ›å»ºæœåŠ¡ç«¯å¤„ç†å™¨

```
server/games/racing/
â””â”€â”€ RacingGameHandler.js
```

### 5.4 æ³¨å†ŒåŠ¨æ€åŠ è½½

åœ¨ `client/main.js` çš„ `loadGameModule()` ä¸­æ·»åŠ ï¼š

```javascript
case 'racing':
    const { RacingGame } = await import('./games/racing/RacingGame.js');
    return RacingGame;
```

åœ¨ `server/games/GameRouter.js` ä¸­æ·»åŠ ï¼š

```javascript
this.handlers = {
    fps: new FPSGameHandler(...),
    racing: new RacingGameHandler(...)
};
```

---

## å…­ã€API å‚è€ƒ

### 6.1 Socket äº‹ä»¶

#### å¤§å…äº‹ä»¶ (LOBBY_EVENTS)

| äº‹ä»¶ | æ–¹å‘ | æ•°æ® | è¯´æ˜ |
|------|------|------|------|
| `lobby:setUsername` | Câ†’S | `string` | è®¾ç½®ç”¨æˆ·å |
| `lobby:getRoomList` | Câ†’S | - | è¯·æ±‚æˆ¿é—´åˆ—è¡¨ |
| `lobby:createRoom` | Câ†’S | `{ name }` | åˆ›å»ºæˆ¿é—´ |
| `lobby:joinRoom` | Câ†’S | `{ roomId }` | åŠ å…¥æˆ¿é—´ |
| `lobby:roomList` | Sâ†’C | `Array<Room>` | æˆ¿é—´åˆ—è¡¨ |
| `lobby:joinSuccess` | Sâ†’C | `{ room }` | åŠ å…¥æˆåŠŸ |
| `lobby:joinFailed` | Sâ†’C | `{ reason }` | åŠ å…¥å¤±è´¥ |

#### æˆ¿é—´äº‹ä»¶ (ROOM_EVENTS)

| äº‹ä»¶ | æ–¹å‘ | æ•°æ® | è¯´æ˜ |
|------|------|------|------|
| `room:leave` | Câ†’S | - | ç¦»å¼€æˆ¿é—´ |
| `room:toggleReady` | Câ†’S | - | åˆ‡æ¢å‡†å¤‡çŠ¶æ€ |
| `room:setGameType` | Câ†’S | `{ gameType }` | è®¾ç½®æ¸¸æˆç±»å‹ |
| `room:startGame` | Câ†’S | - | å¼€å§‹æ¸¸æˆ |
| `room:stateUpdate` | Sâ†’C | `RoomState` | æˆ¿é—´çŠ¶æ€æ›´æ–° |
| `room:gameStarting` | Sâ†’C | `{ gameType }` | æ¸¸æˆå¼€å§‹ |

#### FPS äº‹ä»¶ (FPS_EVENTS)

| äº‹ä»¶ | æ–¹å‘ | æ•°æ® | è¯´æ˜ |
|------|------|------|------|
| `fps:shoot` | Câ†’S / Sâ†’C | `{ id }` | å°„å‡» |
| `fps:hit` | Câ†’S | `{ targetId }` | å‘½ä¸­ |
| `fps:healthUpdate` | Sâ†’C | `number` | è¡€é‡æ›´æ–° |
| `fps:death` | Sâ†’C | `{ killerId, victimId }` | æ­»äº¡ |
| `fps:respawn` | Sâ†’C | `{ x, z, health }` | é‡ç”Ÿ |

---

## ä¸ƒã€å˜æ›´è®°å½•

### åˆ é™¤çš„æ–‡ä»¶

| æ–‡ä»¶ | è¡Œæ•° | è¯´æ˜ |
|------|------|------|
| `client/game.js` | 843 | åŸå•ä½“å®¢æˆ·ç«¯ |
| `server/server.js` | 289 | åŸå•ä½“æœåŠ¡ç«¯ |
| `GEMINI.md` | 15 | æ—§é¡¹ç›®è¯´æ˜ |

### æ–°å¢çš„æ–‡ä»¶

| ç›®å½• | æ–‡ä»¶æ•° | è¯´æ˜ |
|------|--------|------|
| `shared/` | 3 | å…±äº«å¸¸é‡å’Œç±»å‹ |
| `client/core/` | 3 | æ ¸å¿ƒæ¨¡å— |
| `client/lobby/` | 3 | å¤§å…æ¨¡å— |
| `client/games/` | 6 | æ¸¸æˆåŸºç±» + FPS |
| `server/core/` | 2 | æ ¸å¿ƒç®¡ç†å™¨ |
| `server/lobby/` | 2 | å¤§å…å¤„ç† |
| `server/games/` | 2 | æ¸¸æˆè·¯ç”± + FPS |
| `doc/` | 1 | æœ¬æ–‡æ¡£ |

**æ€»è®¡**: åˆ é™¤ 3 ä¸ªæ–‡ä»¶ï¼Œæ–°å¢ 22 ä¸ªæ¨¡å—æ–‡ä»¶

---

## å…«ã€åç»­ä¼˜åŒ–å»ºè®®

1. **æ·»åŠ  TypeScript** - æä¾›ç±»å‹å®‰å…¨
2. **æ·»åŠ å•å…ƒæµ‹è¯•** - æµ‹è¯•æ ¸å¿ƒé€»è¾‘
3. **å®ç°æ–­çº¿é‡è¿** - æ¸¸æˆä¸­æ–­çº¿æ¢å¤
4. **æ·»åŠ æˆ¿é—´èŠå¤©** - æˆ¿é—´å†…æ–‡å­—äº¤æµ
5. **å®ç°è§‚æˆ˜æ¨¡å¼** - æ¸¸æˆä¸­åŠ å…¥çš„ç©å®¶å¯è§‚æˆ˜
6. **æ·»åŠ æ¸¸æˆç»“ç®—** - æ¸¸æˆç»“æŸåæ˜¾ç¤ºç»“æœ
7. **æ€§èƒ½ä¼˜åŒ–** - ç½‘ç»œåŒæ­¥é¢‘ç‡ä¼˜åŒ–ã€å¯¹è±¡æ± 
